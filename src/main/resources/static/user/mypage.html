<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€</title>
    <script>
        // âœ… í˜„ì¬ ë¡œê·¸ì¸í•œ ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        // const userId = localStorage.getItem('userId');
        // fetch(`/user-game/my-participations?userId=${userId}`)
        function loadCurrentUserAndMatches() {
            const token = localStorage.getItem('token');
            if (!token) {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");
                return;
            }

            // ğŸŸ¢ 1ë‹¨ê³„: /auth/user/me í˜¸ì¶œí•´ì„œ userId ê°€ì ¸ì˜¤ê¸°
            fetch('/auth/user/me', {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨');
                    }
                    return response.json();
                })
                .then(userData => {
                    const userId = userData.userId;  // âœ… ì´ì œ userIdë¥¼ ì—¬ê¸°ì„œ ê°€ì ¸ì˜´
                    document.getElementById('nickname').innerText = userData.nickname;

                    // ğŸŸ¢ 2ë‹¨ê³„: ê°€ì ¸ì˜¨ userIdë¡œ ë§¤ì¹­ ëª©ë¡ ì¡°íšŒ
                    loadMyParticipations(userId);
                })
                .catch(error => {
                    console.error(error);
                    alert("ìœ ì € ì •ë³´ ë¡œë”© ì‹¤íŒ¨");
                });
        }

        // âœ… ë‚´ ì°¸ì—¬ ë§¤ì¹­ ëª©ë¡ ì¡°íšŒ
        function loadMyParticipations(userId) {
            fetch(`/user-game/my-participations?userId=${userId}`)
                .then(response => response.json())
                .then(data => {
                    const listEl = document.getElementById('participationList');
                    listEl.innerHTML = '';  // ì´ˆê¸°í™”
                    data.forEach(match => {
                        const li = document.createElement('li');
                        li.textContent = `ë§¤ì¹­ ID: ${match.id} | ì¥ì†Œ: ${match.location} | ë‚ ì§œ: ${match.time}` ;
                        listEl.appendChild(li);
                    });
                });
        }z

        // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.onload = loadCurrentUserAndMatches;
    </script>
</head>
<body>
<h2>ë‚´ ì •ë³´ (ë§ˆì´í˜ì´ì§€)</h2>
<p>ë‹‰ë„¤ì„: <span id="nickname"></span></p>
<hr>
<a href="../index.html">í™ˆ í™”ë©´</a>

<h3>âœ… ë‚´ê°€ ì°¸ê°€í•œ ë§¤ì¹­ ëª©ë¡</h3>
<ul id="participationList">
    <!-- ì—¬ê¸°ì— ìë™ìœ¼ë¡œ ëª©ë¡ì´ ì¶œë ¥ë¨ -->
</ul>

</body>
</html>
